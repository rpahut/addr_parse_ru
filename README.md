# Addr_parse_ru
Парсер адресов на русском языке, использующий библиотеку Yargy.
Парсер является развитием библиотеки https://github.com/Kugumi/Addr_parse.

# Ограничения
Парсер подойдёт для разбора большинства адресов записанных русским языком и по общепринятым бытовым нормам. Фактически парсер налажен для разбора московских жилых адресов. Парсер способен правильно определять части адреса, в том числе в неполных адресах, если они следуют в строке в общепринятом порядке (от страны до номера квартиры), обозначены соответствующими ключевыми словами (город, улица, дом), или сами по себе имеют достаточно отличительную форму (индекс).

Парсер может спотыкаться на неочевидных конструкциях, не покрывает двойную нумерацию, и экзотические номера домов встречающиеся в КЛАДР. В строках, не являющихся адресом, парсер может принимать слова или сокращения за элементы адреса и возвращать ложные результаты.

Парсер не различает настоящие и вымышленные адреса.

Парсер указывает ключевое слово вместе с возвращаемым именем части, но не умеет помещать его слева или справа следуя нормам языка. Ключевое слово для части присоединяется механически, всегда слева или всегда справа (республика Адыгея и республика Карачаево-Черкесская, Академический район и Арбат район).

# Принцип работы
Функция `parsing.parse_address()` принимает строку адреса и возвращает извлечённые из неё компоненты.
`print(parse_address('162390, Россия, Вологодская область, город Великий Устюг, пер. Октябрьский, 1а'))`
`>('Россия', 'Вологодская область', 'город Великий Устюг', '', '', 'переулок Октябрьский', 'дом 1а', '', '162390')`

В первую очередь обрабатываемая строка нормализуется - упрощается пунктуация, разворачиваются сокращения и пр.

Из строки извлекается почтовый индекс.

Из строки извлекаются части с названием страны, города, региона, поселения. Собственные имена городов, поселений, регионов в первую очередь опознаются по внешним перечням из директории external_constants. Если название поселения не обнаружено точным совпадением, производится нечёткий поиск (только для названий из одного слова) с помощью библиотеки fuzzywuzzy.

К оставшейся части строки применяются грамматики yargy, извлекающие регион, район, поселение, улицу, дом, квартиру.

Если название улицы не обнаружено ранее, библиотека пытается угадать её в оставшейся части строки. Предполагается что другие именованные части уже извлечены, поэтому в качестве имени улицы рассматриваются и названия без ключевого слова.

Поскольку регион и поселение оба извлекаются двумя путями (по списку названий и по грамматическому правилу), для них в отдельных случаях возможно обнаружение двух значений. Возвращаемые region и settlement могут содержать два значения, разделённые знаком "|".

Если в возвращаемых частях указываются ключевые слова то всегда в полной форме, даже если в строке адреса это ключевое записано сокращённо.


Функция `parsing.parse_settlement()` ипринимает строку адреса и извлекает из неё название населённого пункта. Как и при обычном разборе, поиск выполняется по списку имён (и опционально по нечёткому совпадению) и затем по правилу yargy.

# Правила yargy
Если части адреса не могут быть опознаны по списку собственных имён, они обнаруживаются и извлекаются при помощи библиотеки yargy и соответствующих грамматических правил.

Правила определены в директории yargy_rules. Правила применяются к строке адреса с помощью функций в parser_func.py.

Правила в своей работе полагаются как на наличие соответвтвующих ключевых слов, так и на формат искомой части адреса, так и на удаление из строки уже опознанных частей.